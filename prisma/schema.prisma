generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String        @id @default(cuid())
  name           String
  email          String        @unique
  phoneNumber    String        @unique
  password       String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  Vehicle        Vehicle[]
  ServiceBooking Appointment[]
}

enum Role {
  ADMIN
  CUSTOMER
  SERVICE_CENTER
}

model ServiceCenter {
  id             String        @id @default(cuid())
  name           String
  email          String        @unique
  password       String
  phoneNumber    String        @unique
  city           String
  latitude       Float?
  longitude      Float?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  ServiceBooking Appointment[]
  Inventory      Inventory[]
}

enum Vtype {
  CAR
  TRUCK
  BIKE
}

model Vehicle {
  id           String        @id @default(cuid())
  vehicleName  String
  vehicleMake  String
  vehicleModel Int
  vehicleType  Vtype
  numberPlate  String        @unique
  userId       String
  owner        User          @relation(fields: [userId], references: [id])
  service      Appointment[]
  createdAt    DateTime      @default(now())
}

enum bookingStatus {
  PENDING
  InService
  COMPLETED
}

enum AppointmentPriority {
  LOW
  MEDIUM
  HIGH
}

model Appointment {
  id                   String              @id @default(cuid())
  vehicleId            String
  Vehicle              Vehicle             @relation(fields: [vehicleId], references: [id])
  userId               String
  owner                User                @relation(fields: [userId], references: [id])
  serviceType          String
  requestedDate        DateTime            @default(now())
  slaDeadline          DateTime?
  actualCompletionDate DateTime?
  slaBreached          Boolean             @default(false)
  priority             AppointmentPriority @default(MEDIUM)
  status               bookingStatus

  serviceCenterId String
  serviceCenter   ServiceCenter @relation(fields: [serviceCenterId], references: [id])

  JobCards JobCards[]
  Invoice  Invoice?

  @@index([vehicleId, userId, serviceCenterId])
}

model JobCards {
  id             String         @id @default(cuid())
  appointmentId  String
  appointment    Appointment    @relation(fields: [appointmentId], references: [id])
  jobName        String
  jobDescription String
  price          Int
  JobCardParts   JobCardParts[]

  @@index([appointmentId])
}

model JobCardParts {
  id        String    @id @default(uuid())
  jobCardId String
  jobCard   JobCards  @relation(fields: [jobCardId], references: [id], onDelete: Cascade)
  partId    String
  partUsed  Inventory @relation(fields: [partId], references: [id], onDelete: Cascade)
  quantity  Int
}

enum Category {
  ENGINE_PARTS
  ELECTRICAL
  BRAKE_SYSTEM
  SUSPENSION
  FLUIDS
  TOOLS
  BODY_PARTS
  ACCESSORIES
  MISC
}

model Inventory {
  id        String    @id @default(uuid())
  name      String
  sku       String    @unique
  brand     String?
  category  Category? // e.g., Engine Parts, Consumables, Electrical
  unitPrice Int
  quantity  Int       @default(0)

  createdAt    DateTime       @default(now())
  JobCardParts JobCardParts[]

  // ðŸ”— relation added â€” nothing else
  serviceCenterId String
  serviceCenter   ServiceCenter @relation(fields: [serviceCenterId], references: [id])

  @@index([serviceCenterId])
}

enum InvoiceStatus {
  SENT
  PAID
  OVERDUE
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceCount  BigInt        @default(autoincrement())
  invoiceNumber String        @unique
  totalAmount   Int
  billingDate   DateTime      @default(now())
  dueDate       DateTime      @default(dbgenerated("now() + interval '7 days'"))
  status        InvoiceStatus @default(SENT)
  appointmentId String        @unique
  appointment   Appointment   @relation(fields: [appointmentId], references: [id])
}
